# #041 「優先度スケジューリング」

```javascript
// priority-workers.mjs
import cluster from 'node:cluster';
import os from 'node:os';
if (cluster.isPrimary) {
  const high = cluster.fork({ ROLE: 'high' });
  const low = cluster.fork({ ROLE: 'low' });
  os.setPriority(high.process.pid, os.constants.priority.PRIORITY_HIGH);
  os.setPriority(low.process.pid, os.constants.priority.PRIORITY_LOW);
} else {
  setInterval(() => {
    console.log(`${process.env.ROLE} worker running with pid ${process.pid}`);
  }, 500);
}
```

```bash
ps -o pid,pri,ni,cmd -p $(pgrep -f priority-workers.mjs)
```

```text
優先度を操作するとスケジューラが高優先度ワーカーにより多くのCPU時間を与えます。
```
