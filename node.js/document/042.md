# #042 「マルチコアCPUの活用」

```javascript
// parallel-pool.mjs
import { Worker, isMainThread, workerData, parentPort } from 'node:worker_threads';
import os from 'node:os';
if (isMainThread) {
  const tasks = Array.from({ length: os.availableParallelism() }, (_, i) => i);
  for (const id of tasks) {
    new Worker(new URL(import.meta.url), { workerData: id });
  }
} else {
  let sum = 0;
  for (let i = 0; i < 1e7; i += 1) {
    sum += i;
  }
  parentPort?.postMessage({ worker: workerData, sum });
}
```

```bash
node parallel-pool.mjs
```

```text
Worker Threads を使うとメインスレッドとは別のコアで計算を並列化できます。
```
