# #036 「コンテキストスイッチ」

```javascript
// worker-yield.mjs
import { Worker, isMainThread, workerData } from 'node:worker_threads';
if (isMainThread) {
  for (let i = 0; i < 4; i += 1) {
    new Worker(new URL(import.meta.url), { workerData: i });
  }
} else {
  console.log(`worker ${workerData} busy loop`);
  setInterval(() => {
    const start = Date.now();
    while (Date.now() - start < 5) {}
  }, 0);
}
```

```bash
top -pid $(pgrep -n node) -stats pid,th,csw
```

```text
csw (context switches) が急増すると切り替えオーバーヘッドが発生しているサインです。
```
