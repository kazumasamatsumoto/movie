# #545 ã€Œãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€

å››å›½ã‚ãŸã‚“ã€ŒAngular/Nest.jsã§ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã¤ã„ã¦å­¦ã³ã¾ã—ã‚‡ã†ï¼ã€
ãšã‚“ã ã‚‚ã‚“ã€Œã©ã†æ›¸ãã®ãŒãƒ™ã‚¹ãƒˆãªã®ï¼Ÿã€
å››å›½ã‚ãŸã‚“ã€Œåˆ¤åˆ¥Unionå‹ã®æ´»ç”¨ã€ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯ã®å¾¹åº•ã€å‹å®šç¾©ã®å…±æœ‰ãŒé‡è¦ã§ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€Œå…·ä½“çš„ãªã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’æ•™ãˆã¦ï¼ã€
å››å›½ã‚ãŸã‚“ã€Œã™ã¹ã¦ã®çŠ¶æ…‹ã‚’å‹ã§è¡¨ç¾ã—ã€neverå‹ã§æœªå‡¦ç†ã‚±ãƒ¼ã‚¹ã‚’æ¤œå‡ºã—ã€ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’çµ±ä¸€ã—ã¾ã™ã­ã€
ãšã‚“ã ã‚‚ã‚“ã€Œãªã‚‹ã»ã©ï¼ãƒãƒ¼ãƒ å…¨ä½“ã§çµ±ä¸€ã§ãã‚‹ã‚“ã ã­ï¼ã€
å››å›½ã‚ãŸã‚“ã€Œå‹é§†å‹•é–‹ç™ºã«ã‚ˆã‚Šã€ãƒã‚°ã®æ—©æœŸç™ºè¦‹ã¨é–‹ç™ºåŠ¹ç‡ã®å‘ä¸ŠãŒå®Ÿç¾ã§ãã¾ã™ã­ã€
ãšã‚“ã ã‚‚ã‚“ã€Œã“ã‚Œã‹ã‚‰ã‚‚å‹å®‰å…¨æ€§ã‚’æœ€å„ªå…ˆã§é–‹ç™ºã™ã‚‹ã‚ˆï¼ã€

---

## ğŸ“º ç”»é¢è¡¨ç¤ºç”¨ã‚³ãƒ¼ãƒ‰

```typescript
// å…±é€šå‹å®šç¾©ï¼ˆshared/types.tsï¼‰
export type Result<T, E = Error> =
  | { ok: true; value: T }
  | { ok: false; error: E };

export function exhaustiveCheck(value: never): never {
  throw new Error(`Unhandled case: ${JSON.stringify(value)}`);
}

export function assertNever(value: never, message?: string): never {
  throw new Error(message ?? `Unexpected: ${value}`);
}
```

```typescript
// ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ã®æ´»ç”¨
@Injectable()
export class UserService {
  async getUser(id: string): Promise<Result<User, UserError>> {
    try {
      const user = await this.repository.findById(id);
      if (!user) return { ok: false, error: { type: 'notfound', id } };
      return { ok: true, value: user };
    } catch (e) {
      return { ok: false, error: { type: 'internal', message: e.message } };
    }
  }
}
```

```typescript
// ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å±¤ã§ã®æ´»ç”¨
@Controller('users')
export class UserController {
  @Get(':id')
  async getUser(@Param('id') id: string): Promise<UserDto> {
    const result = await this.service.getUser(id);

    if (result.ok) return this.toDto(result.value);
    if (!result.ok && result.error.type === 'notfound') throw new NotFoundException();
    if (!result.ok && result.error.type === 'internal') throw new InternalServerErrorException();
    return exhaustiveCheck(result);
  }
}
```
