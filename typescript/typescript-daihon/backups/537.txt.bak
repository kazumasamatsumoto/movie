# #537 ã€Œãƒ«ãƒ¼ãƒˆã‚¬ãƒ¼ãƒ‰ã€

å››å›½ã‚ãŸã‚“ã€Œãƒ«ãƒ¼ãƒˆã‚¬ãƒ¼ãƒ‰ã§ã®ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯ã«ã¤ã„ã¦å­¦ã³ã¾ã—ã‚‡ã†ï¼ã€
ãšã‚“ã ã‚‚ã‚“ã€Œãƒ«ãƒ¼ãƒˆã‚¬ãƒ¼ãƒ‰ã§ã©ã†ç¶²ç¾…æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã®ï¼Ÿã€
å››å›½ã‚ãŸã‚“ã€Œã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆçŠ¶æ…‹ã‚’åž‹ã§å®šç¾©ã—ã€neveråž‹ã§æœªå‡¦ç†ã‚±ãƒ¼ã‚¹ã‚’æ¤œå‡ºã—ã¾ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€Œå…·ä½“çš„ã«ã©ã†å®Ÿè£…ã™ã‚‹ã®ï¼Ÿã€
å››å›½ã‚ãŸã‚“ã€Œåˆ¤åˆ¥Unionåž‹ã§ãƒ«ãƒ¼ãƒˆçŠ¶æ…‹ã‚’è¡¨ç¾ã—ã€ç¶²ç¾…çš„ã«ã‚¬ãƒ¼ãƒ‰å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã­ã€
ãšã‚“ã ã‚‚ã‚“ã€Œãªã‚‹ã»ã©ï¼æ–°ã—ã„ãƒ«ãƒ¼ãƒˆè¿½åŠ æ™‚ã‚‚å®‰å…¨ã ã­ï¼ã€
å››å›½ã‚ãŸã‚“ã€Œåž‹å®‰å…¨æ€§ã«ã‚ˆã‚Šã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚ã®è¦‹è½ã¨ã—ã‚‚é˜²ã’ã¾ã™ã­ã€
ãšã‚“ã ã‚‚ã‚“ã€Œå¤§è¦æ¨¡ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ç‰¹ã«é‡è¦ã ã‚ˆï¼ã€

---

## ðŸ“º ç”»é¢è¡¨ç¤ºç”¨ã‚³ãƒ¼ãƒ‰

```typescript
// ãƒ«ãƒ¼ãƒˆçŠ¶æ…‹ã®åž‹å®šç¾©
type RouteState =
  | { type: 'public' }
  | { type: 'protected'; requiredRole: string }
  | { type: 'admin' };

function canAccess(state: RouteState, userRole: string): boolean {
  if (state.type === 'public') return true;
  if (state.type === 'protected') return userRole === state.requiredRole;
  if (state.type === 'admin') return userRole === 'admin';
  const check: never = state;
  return false;
}
```

```typescript
// è¤‡é›‘ãªã‚¬ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯
type Permission = 'read' | 'write' | 'delete';
type GuardCheck =
  | { check: 'role'; role: string }
  | { check: 'permission'; permission: Permission };

function validateGuard(check: GuardCheck, user: User): boolean {
  if (check.check === 'role') return user.role === check.role;
  if (check.check === 'permission') return user.permissions.includes(check.permission);
  const exhaustive: never = check;
  return false;
}
```

```typescript
// CanActivateFn with ç¶²ç¾…æ€§
export const authGuard: CanActivateFn = (route, state) => {
  const requiredAuth = route.data['auth'] as AuthType;

  if (requiredAuth === 'none') return true;
  if (requiredAuth === 'user') return checkUser();
  if (requiredAuth === 'admin') return checkAdmin();
  const check: never = requiredAuth;
  return false;
};
```
