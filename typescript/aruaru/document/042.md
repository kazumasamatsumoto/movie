# #042 「`flatMap`の型を追っていたら朝になった」制作ドキュメント

## 台本
ずんだもん「TypeScript書いてるとさ、`flatMap`の型を追っていたら朝になったって絶対あるよね？」
四国めたん「わかります。Promiseチェーンを追ってると朝を迎えますよね」
ずんだもん「しかもそのまま`flatMap`の型を追っていたら朝になった状態になって、チーム全員が固まるんだよ！」
四国めたん「そこでTypeScriptの`Awaited`と非同期型整備を使えば、`Awaited`で戻り値を先に取り出しておくと安心です」
ずんだもん「いや待って、それやると`flatMap`の型を追っていたら朝になった第2ラウンドが始まるやつ！」
四国めたん「共感した方は“非同期迷子”ってコメントで教えてください！」
ずんだもん「あなたのTypeScriptあるあるも募集中だよ！」

## 画面表示用コード

```typescript
async function fetchUser() {
  return { id: "1", name: "m" };
}

type UserPromise = ReturnType<typeof fetchUser>;
type User = Awaited<UserPromise>;

async function load() {
  const user: User = await fetchUser();
  return user.name?.toUpperCase();
}

load().then(console.log);

type Fetcher<T> = () => Promise<T>;

function mapFetcher<T, U>(fn: Fetcher<T>, map: (value: T) => U): Fetcher<U> {
  return async () => map(await fn());
}
```

## 制作メモ
- **想定シーン**: `flatMap`の型を追っていたら朝になったに遭遇した瞬間を切り取るネタ
- **狙いトーン**: 深夜デバッグ感を演出
- **技術キーワード**: Promise, `Awaited`, 非同期
- **使いたい一言**: 「非同期迷子」
- **CTA案**: コメントで「非同期迷子」と書いてもらい、同じ経験を募る
- **備考**: APIレスポンス整形やoptional chainingを絡めると良いです。
