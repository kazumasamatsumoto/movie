# #129 「`Immer`の型推論、満足してる？」制作ドキュメント

## 台本
ずんだもん「`Immer`の型推論、満足してる？」
四国めたん「v5.9では`Immer`との連携がさらにスムーズになり、Draft型の推論が改善されています」
ずんだもん「ぼくは`Immer`で不変更新を書きつつ、型推論が効くから可読性と型安全性の両立ができて気に入ってるんだよね」
四国めたん「`Immer`は内部でProxyを使ってミュータブルな書き方を不変更新に変換し、TypeScriptの型推論もしっかり効きます」
ずんだもん「Reduxのreducerで複雑なstate更新を`Immer`で書いたら、コードが劇的に読みやすくなったんだよ！」
四国めたん「みなさんは`Immer`の型推論に満足していますか？」
ずんだもん「使用感や型の問題があったらコメントで教えてね！」

## 画面表示用コード

```typescript
import { produce } from 'immer';

type State = {
  users: Array<{
    id: string;
    name: string;
    posts: Array<{ id: string; title: string }>;
  }>;
};

// Immerを使った不変更新（ミュータブルな書き方で書ける）
const nextState = produce(state, draft => {
  const user = draft.users.find(u => u.id === '123');
  if (user) {
    user.name = 'Updated'; // Draft型で型推論が効く
    user.posts.push({ id: '456', title: 'New Post' });
  }
});
```

```typescript
// 従来の不変更新（複雑で読みにくい）
const nextState = {
  ...state,
  users: state.users.map(user =>
    user.id === '123'
      ? {
          ...user,
          name: 'Updated',
          posts: [...user.posts, { id: '456', title: 'New Post' }]
        }
      : user
  )
};
```

## 制作メモ
- **問いの切り口**: Immerの型推論への満足度
- **想定視聴者層**: 不変更新を扱うエンジニア、Redux/状態管理ユーザー
- **押さえる技術キーワード**: Immer, Draft型, 不変更新, 型推論
- **キャラの立場**: 四国めたん=技術的仕組み解説 / ずんだもん=実用的メリット紹介
- **コメントで聞きたいこと**: 型推論の満足度や使用感
- **補足メモ**: 従来の不変更新との比較で可読性の向上を強調
