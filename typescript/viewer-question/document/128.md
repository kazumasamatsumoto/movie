# #128 「`immutable`データ構造、どう型付けてる？」制作ドキュメント

## 台本
ずんだもん「`immutable`データ構造、どう型付けてる？」
四国めたん「v5.9では`readonly`修飾子と`as const`の組み合わせで、不変データ構造の型付けが強力になっています」
ずんだもん「ぼくは`ReadonlyArray`や`Readonly<T>`を使って、意図しない変更を型レベルで防ぐようにしてるんだよね」
四国めたん「不変データ構造を型で表現すると、関数の副作用が明確になり、予期しない状態変更を防げます」
ずんだもん「Reactのstateを`readonly`で型付けしたら、直接変更するバグが完全になくなったんだよ！」
四国めたん「みなさんは不変データ構造をどう型付けていますか？」
ずんだもん「実装パターンや工夫をコメントで教えてね！」

## 画面表示用コード

```typescript
// readonly配列
function processItems(items: ReadonlyArray<string>): string[] {
  // items.push('new'); // Error: プロパティ 'push' は存在しません
  return [...items, 'new']; // 新しい配列を返す
}

// readonlyオブジェクト
type User = Readonly<{
  id: string;
  name: string;
  email: string;
}>;

function updateUser(user: User, updates: Partial<User>): User {
  // user.name = 'new'; // Error: 読み取り専用プロパティ
  return { ...user, ...updates }; // 新しいオブジェクトを返す
}
```

```typescript
// Deep Readonly型
type DeepReadonly<T> = {
  readonly [P in keyof T]: T[P] extends object
    ? DeepReadonly<T[P]>
    : T[P];
};

type Config = DeepReadonly<{
  database: {
    host: string;
    port: number;
  };
}>;
```

## 制作メモ
- **問いの切り口**: 不変データ構造の型付け方法
- **想定視聴者層**: 不変性を重視するエンジニア
- **押さえる技術キーワード**: readonly, ReadonlyArray, Readonly, 不変性
- **キャラの立場**: 四国めたん=型システムの機能解説 / ずんだもん=実用的な効果紹介
- **コメントで聞きたいこと**: 不変データ構造の型付けパターンや工夫
- **補足メモ**: readonlyによる副作用防止の実践的な利点を強調
