# #121 「`custom error`の型階層、どう設計してる？」制作ドキュメント

## 台本
ずんだもん「`custom error`の型階層、どう設計してる？」
四国めたん「v5.9では抽象クラスとジェネリクスを組み合わせて、柔軟なエラー階層が構築できるようになっています」
ずんだもん「ぼくは基底エラークラスを作って、そこから用途別にサブクラスを派生させる設計が好きなんだよね」
四国めたん「エラー階層を設計する際は、共通プロパティを基底クラスに持たせ、特定のエラーに必要な情報をサブクラスで追加します」
ずんだもん「ドメイン層とインフラ層で別のエラー階層を作って、境界で変換することでレイヤーが綺麗に分離できたんだよ！」
四国めたん「みなさんはカスタムエラーの型階層をどう設計していますか？」
ずんだもん「エラー設計のパターンをコメントで共有してね！」

## 画面表示用コード

```typescript
// 基底エラークラス
abstract class AppError extends Error {
  constructor(
    message: string,
    public readonly code: string,
    public readonly statusCode: number
  ) {
    super(message);
    this.name = this.constructor.name;
  }
}

// ドメインエラー
class DomainError extends AppError {
  constructor(message: string, code: string) {
    super(message, code, 400);
  }
}

class ValidationError extends DomainError {
  constructor(public field: string, message: string) {
    super(message, 'VALIDATION_ERROR');
  }
}

// インフラエラー
class InfraError extends AppError {
  constructor(message: string, code: string, statusCode: number) {
    super(message, code, statusCode);
  }
}

class DatabaseError extends InfraError {
  constructor(message: string, public query: string) {
    super(message, 'DATABASE_ERROR', 500);
  }
}
```

```typescript
// レイヤー間のエラー変換
function toHttpError(error: AppError): HttpResponse {
  return {
    statusCode: error.statusCode,
    body: { code: error.code, message: error.message }
  };
}
```

## 制作メモ
- **問いの切り口**: カスタムエラーの型階層設計
- **想定視聴者層**: エラー設計のアーキテクチャを考えるエンジニア
- **押さえる技術キーワード**: 継承, 抽象クラス, エラー階層, レイヤードアーキテクチャ
- **キャラの立場**: 四国めたん=設計原則解説 / ずんだもん=実装パターン紹介
- **コメントで聞きたいこと**: エラー階層の設計パターンや実践例
- **補足メモ**: レイヤードアーキテクチャにおけるエラー設計の実例を提示
