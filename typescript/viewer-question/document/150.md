# #150 「`InstanceType`の出番、どういうとき？」制作ドキュメント

## 台本
ずんだもん「`InstanceType`の出番、どういうとき？」
四国めたん「v5.9では`InstanceType`はクラスのインスタンス型を取得でき、ファクトリーや型定義で役立ちます」
ずんだもん「ぼくはクラス自体を値として扱う時に、そのインスタンス型を`InstanceType`で取得するんだよね」
四国めたん「`InstanceType`は、クラスコンストラクタからインスタンスの型を抽出するユーティリティ型です」
ずんだもん「抽象ファクトリーパターンで、クラスを引数に取る関数の戻り値型を`InstanceType`で定義できたんだよ！」
四国めたん「みなさんは`InstanceType`を使う場面がありますか？」
ずんだもん「使用ケースをコメントで教えてね！」

## 画面表示用コード

```typescript
// クラスからインスタンス型を取得
class User {
  constructor(public id: string, public name: string) {}

  greet() {
    return `Hello, ${this.name}`;
  }
}

type UserInstance = InstanceType<typeof User>;
// { id: string; name: string; greet(): string }
```

```typescript
// ファクトリー関数の戻り値型
function createService<T extends new (...args: any[]) => any>(
  ServiceClass: T,
  ...args: ConstructorParameters<T>
): InstanceType<T> {
  return new ServiceClass(...args);
}

const userService = createService(UserService, config);
// 型はInstanceType<typeof UserService>として推論される
```

```typescript
// レジストリパターン
class ServiceRegistry {
  private services = new Map<any, any>();

  register<T extends new (...args: any[]) => any>(
    token: T,
    instance: InstanceType<T>
  ): void {
    this.services.set(token, instance);
  }

  get<T extends new (...args: any[]) => any>(token: T): InstanceType<T> {
    return this.services.get(token);
  }
}
```

## 制作メモ
- **問いの切り口**: InstanceTypeの使用場面
- **想定視聴者層**: クラスベースの設計を行うエンジニア
- **押さえる技術キーワード**: InstanceType, クラス, インスタンス型, ファクトリー
- **キャラの立場**: 四国めたん=ユーティリティの解説 / ずんだもん=実装パターン紹介
- **コメントで聞きたいこと**: 使用場面やケース
- **補足メモ**: ファクトリーとレジストリという実用パターンで説明
