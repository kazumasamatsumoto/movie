# #165 「クラスデコレータ、使ったことある？」制作ドキュメント

## 台本
ずんだもん「クラスデコレータ、使ったことある？」
四国めたん「v5.9ではクラスデコレータでクラス全体の振る舞いを変更でき、フレームワークで広く使われています」
ずんだもん「ぼくはクラスにメタデータを付けたり、シングルトンパターンを実装する時にクラスデコレータを使うんだよね」
四国めたん「クラスデコレータはクラス定義を受け取り、新しいクラスを返すか、元のクラスを変更できます」
ずんだもん「NestJSで`@Controller`デコレータを自作したら、ルーティング設定が自動化されて便利だったんだよ！」
四国めたん「みなさんはクラスデコレータを使ったことがありますか？」
ずんだもん「使用例や自作経験をコメントで教えてね！」

## 画面表示用コード

```typescript
// シングルトンデコレータ
function Singleton<T extends new (...args: any[]) => any>(constructor: T) {
  let instance: T | null = null;

  return class extends constructor {
    constructor(...args: any[]) {
      if (instance) {
        return instance as any;
      }
      super(...args);
      instance = this as any;
    }
  } as T;
}

@Singleton
class Database {
  constructor(public url: string) {}
}

const db1 = new Database('url1');
const db2 = new Database('url2');
console.log(db1 === db2); // true
```

```typescript
// メタデータ付与デコレータ
function Entity(tableName: string) {
  return function<T extends new (...args: any[]) => any>(constructor: T) {
    constructor.prototype.tableName = tableName;
    return constructor;
  };
}

@Entity('users')
class User {
  name: string;
}
```

## 制作メモ
- **問いの切り口**: クラスデコレータの使用経験
- **想定視聴者層**: デコレータを活用したいエンジニア
- **押さえる技術キーワード**: クラスデコレータ, メタデータ, シングルトン
- **キャラの立場**: 四国めたん=用途解説 / ずんだもん=実装パターン紹介
- **コメントで聞きたいこと**: 使用経験や自作例
- **補足メモ**: シングルトンという実用的なパターンを提示
