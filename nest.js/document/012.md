# #012 「エンタープライズ開発 - スケーラビリティ」

四国めたん「NestJSはエンタープライズ環境でスケーラビリティを重視します」
ずんだもん「高負荷なAPIでどんな設計を押さえればいいの？」
四国めたん「ステートレス化とConfig駆動で水平スケールしやすくします」
ずんだもん「環境変数で接続先を切り替えればコンテナも楽だよ」
四国めたん「ヘルスチェックとGraceful Shutdownでオーケストレーターと連携します」
ずんだもん「Podの入れ替えでもリクエストが落ちにくくなるね」
四国めたん「キューやキャッシュをModule化してボトルネックを分離しましょう」
ずんだもん「スケール戦略をコードで標準化できるのが心強いよ！」

---

## 📺 画面表示用コード

```typescript
// main.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  app.enableShutdownHooks();
  app.enableCors({ origin: process.env.ALLOWED_ORIGINS?.split(',') });
  await app.listen(process.env.PORT ?? 3000);
}
bootstrap();

// app.module.ts
import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import { TerminusModule } from '@nestjs/terminus';
import { BullModule } from '@nestjs/bullmq';

@Module({
  imports: [
    ConfigModule.forRoot({ isGlobal: true, cache: true }),
    TerminusModule,
    BullModule.registerQueue({ name: 'email' }),
  ],
})
export class AppModule {}

// health.controller.ts
import { Controller, Get } from '@nestjs/common';
import { HealthCheck, HealthCheckService, MemoryHealthIndicator } from '@nestjs/terminus';

@Controller('health')
export class HealthController {
  constructor(
    private readonly health: HealthCheckService,
    private readonly memory: MemoryHealthIndicator,
  ) {}

  @Get()
  @HealthCheck()
  check() {
    return this.health.check([
      () => this.memory.checkHeap('memory_heap', 150 * 1024 * 1024),
    ]);
  }
}
```
