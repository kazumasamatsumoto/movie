# #012 ã€Œã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºé–‹ç™º - ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã€

å››å›½ã‚ãŸã‚“ã€ŒNestJSã¯ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç’°å¢ƒã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚’é‡è¦–ã—ã¾ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€Œé«˜è² è·ãªAPIã§ã©ã‚“ãªè¨­è¨ˆã‚’æŠ¼ã•ãˆã‚Œã°ã„ã„ã®ï¼Ÿã€
å››å›½ã‚ãŸã‚“ã€Œã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹åŒ–ã¨Configé§†å‹•ã§æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒ«ã—ã‚„ã™ãã—ã¾ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€Œç’°å¢ƒå¤‰æ•°ã§æŽ¥ç¶šå…ˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚Œã°ã‚³ãƒ³ãƒ†ãƒŠã‚‚æ¥½ã ã‚ˆã€
å››å›½ã‚ãŸã‚“ã€Œãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã¨Graceful Shutdownã§ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¨é€£æºã—ã¾ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€ŒPodã®å…¥ã‚Œæ›¿ãˆã§ã‚‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè½ã¡ã«ãããªã‚‹ã­ã€
å››å›½ã‚ãŸã‚“ã€Œã‚­ãƒ¥ãƒ¼ã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ModuleåŒ–ã—ã¦ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’åˆ†é›¢ã—ã¾ã—ã‚‡ã†ã€
ãšã‚“ã ã‚‚ã‚“ã€Œã‚¹ã‚±ãƒ¼ãƒ«æˆ¦ç•¥ã‚’ã‚³ãƒ¼ãƒ‰ã§æ¨™æº–åŒ–ã§ãã‚‹ã®ãŒå¿ƒå¼·ã„ã‚ˆï¼ã€

---

## ðŸ“º ç”»é¢è¡¨ç¤ºç”¨ã‚³ãƒ¼ãƒ‰

```typescript
// main.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  app.enableShutdownHooks();
  app.enableCors({ origin: process.env.ALLOWED_ORIGINS?.split(',') });
  await app.listen(process.env.PORT ?? 3000);
}
bootstrap();

// app.module.ts
import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import { TerminusModule } from '@nestjs/terminus';
import { BullModule } from '@nestjs/bullmq';

@Module({
  imports: [
    ConfigModule.forRoot({ isGlobal: true, cache: true }),
    TerminusModule,
    BullModule.registerQueue({ name: 'email' }),
  ],
})
export class AppModule {}

// health.controller.ts
import { Controller, Get } from '@nestjs/common';
import { HealthCheck, HealthCheckService, MemoryHealthIndicator } from '@nestjs/terminus';

@Controller('health')
export class HealthController {
  constructor(
    private readonly health: HealthCheckService,
    private readonly memory: MemoryHealthIndicator,
  ) {}

  @Get()
  @HealthCheck()
  check() {
    return this.health.check([
      () => this.memory.checkHeap('memory_heap', 150 * 1024 * 1024),
    ]);
  }
}
```
