# #047 「nest generate filter - フィルター生成」

四国めたん「nest generate filterで例外処理用のフィルターを生成できます」
ずんだもん「どんなコードが出力されるの？」
四国めたん「ExceptionFilterを実装したクラスにcatchメソッドが用意されます」
ずんだもん「HTTPレスポンスの整形やログ出力に使えるね」
四国めたん「グローバル登録すればアプリ全体のエラー整形を統一できます」
ずんだもん「CLIでフィルターを揃えて異常系も管理するよ！」

---

## 📺 画面表示用コード

```typescript
// generate-filter.ts
export const generateFilter = 'nest g filter common/http-exception';

// http-exception.filter.ts
import { ArgumentsHost, Catch, ExceptionFilter, HttpException, HttpStatus } from '@nestjs/common';

@Catch()
export class HttpExceptionFilter implements ExceptionFilter {
  catch(exception: unknown, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse();
    const status = exception instanceof HttpException ? exception.getStatus() : HttpStatus.INTERNAL_SERVER_ERROR;

    response.status(status).json({
      statusCode: status,
      message: exception instanceof Error ? exception.message : 'Unexpected error',
    });
  }
}

// filter-registration.ts
export const registerFilter = 'app.useGlobalFilters(new HttpExceptionFilter())';
```
