# #020 ã€ŒéåŒæœŸå‡¦ç†åŸºç¤ - Promise ã¨ async/awaitã€

å››å›½ã‚ãŸã‚“ã€ŒNestJSã§ã¯Promiseã¨async/awaitã‚’å‰æã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€ŒéåŒæœŸã®æ‰±ã„ã§æ°—ã‚’ã¤ã‘ã‚‹ãƒã‚¤ãƒ³ãƒˆã¯ä½•ã‹ãªï¼Ÿã€
å››å›½ã‚ãŸã‚“ã€ŒServiceã‚„Controllerã¯Promiseã‚’è¿”ã—ã¦DIã‚³ãƒ³ãƒ†ãƒŠãŒè§£æ±ºã—ã¾ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€Œawaitã§ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’ã¾ã¨ã‚ã‚‹ã¨èª­ã¿ã‚„ã™ã„ã‚ˆã€
å››å›½ã‚ãŸã‚“ã€Œä¾‹å¤–ã¯HttpExceptionã§ãƒ©ãƒƒãƒ—ã—ã¤ã¤throwã—ã¾ã—ã‚‡ã†ã€
ãšã‚“ã ã‚‚ã‚“ã€Œtry-catchã§ãƒ­ã‚°ã‚’æŒŸã‚“ã§ãŠãã¨ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„ã­ã€
å››å›½ã‚ãŸã‚“ã€ŒPromise.allã§ä¸¦åˆ—åŒ–ã™ã‚‹ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é«˜é€ŸåŒ–ã§ãã¾ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€ŒéåŒæœŸã‚’åˆ¶å¾¡ã§ãã‚Œã°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒãã£ã¨ä¸ŠãŒã‚‹ã‚ˆï¼ã€

---

## ğŸ“º ç”»é¢è¡¨ç¤ºç”¨ã‚³ãƒ¼ãƒ‰

```typescript
// user.service.ts
import { Injectable } from '@nestjs/common';

@Injectable()
export class UserService {
  async findById(id: string) {
    return { id, name: 'User' };
  }
}

// user.controller.ts
import { Controller, Get, Param } from '@nestjs/common';
import { UserService } from './user.service';

@Controller('users')
export class UserController {
  constructor(private readonly users: UserService) {}

  @Get(':id')
  async getUser(@Param('id') id: string) {
    const user = await this.users.findById(id);
    return user;
  }
}

// parallel.service.ts
import { Injectable, HttpException } from '@nestjs/common';

@Injectable()
export class ParallelService {
  async fetchAggregated(id: string) {
    try {
      const [profile, orders] = await Promise.all([
        this.loadProfile(id),
        this.loadOrders(id),
      ]);
      return { profile, orders };
    } catch (error) {
      throw new HttpException('Failed to load resources', 503, { cause: error });
    }
  }

  private loadProfile(id: string) {
    return Promise.resolve({ id, name: 'User' });
  }

  private loadOrders(id: string) {
    return Promise.resolve([{ id: 'order-1' }]);
  }
}
```
