# #025 「ステータスコード理解」

四国めたん「HTTPステータスコードはクライアントとの契約です」
ずんだもん「200以外をどう使い分けるといいの？」
四国めたん「成功は200・201・204、クライアントエラーは4xxで分類します」
ずんだもん「バリデーションエラーは422で返したいね」
四国めたん「サーバー側の障害は5xxで通知し監視と連携しましょう」
ずんだもん「503はリトライ戦略とセットで考えるよ」
四国めたん「NestJSはHttpExceptionでステータスを明示できます」
ずんだもん「正しいステータスが揃うとAPIの信頼性が上がるよ！」

---

## 📺 画面表示用コード

```typescript
// users.controller.ts
import { Controller, Get, HttpCode, Param, Post } from '@nestjs/common';
import { HttpStatus } from '@nestjs/common';

@Controller('users')
export class UsersController {
  @Post()
  @HttpCode(HttpStatus.CREATED)
  create() {
    return { status: 'created' };
  }

  @Get(':id')
  @HttpCode(HttpStatus.OK)
  find(@Param('id') id: string) {
    return { id };
  }
}

// validation-exception.filter.ts
import { ArgumentsHost, Catch, ExceptionFilter, HttpException, HttpStatus } from '@nestjs/common';
import { ValidationError } from 'class-validator';

@Catch(ValidationError)
export class ValidationExceptionFilter implements ExceptionFilter {
  catch(exception: ValidationError, host: ArgumentsHost) {
    const response = host.switchToHttp().getResponse();
    response.status(HttpStatus.UNPROCESSABLE_ENTITY).json({
      message: 'Validation failed',
      details: exception.toString(),
    });
  }
}

// service-error.ts
import { HttpException, HttpStatus } from '@nestjs/common';

export class ServiceUnavailableError extends HttpException {
  constructor(cause?: Error) {
    super('Service temporarily unavailable', HttpStatus.SERVICE_UNAVAILABLE, {
      cause,
    });
  }
}
```
