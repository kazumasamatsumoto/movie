# #006 「v11新機能 - JSON Logging詳解」

四国めたん「v11ではJSON Loggingが公式サポートされました」
ずんだもん「構造化ログを標準で出せるのは嬉しいね」
四国めたん「ConsoleLoggerにjsonオプションが追加され、Loggerサービスから使えます」
ずんだもん「外部のログ基盤にもすぐ連携できるよ」
四国めたん「メタデータを含めて出力すればトレース性が高まります」
ずんだもん「タイムスタンプもUTCで揃えられて便利だね」
四国めたん「アプリ起動時にJsonLoggerへ切り替えるだけで移行できます」
ずんだもん「本番環境の可観測性がどんどん整うよ！」

---

## 📺 画面表示用コード

```typescript
// json-logger.ts
import { ConsoleLogger, LogLevel } from '@nestjs/common';

export class JsonLogger extends ConsoleLogger {
  constructor(context?: string, levels?: LogLevel[]) {
    super(context, { logLevels: levels, json: true });
  }
}

// main.ts
import { NestFactory } from '@nestjs/core';
import { JsonLogger } from './json-logger';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule, { bufferLogs: true });
  app.useLogger(new JsonLogger('Bootstrap'));
  await app.listen(3000);
}
bootstrap();

// logging.interceptor.ts
import { CallHandler, ExecutionContext, Injectable, NestInterceptor } from '@nestjs/common';
import { JsonLogger } from './json-logger';
import { tap } from 'rxjs/operators';

@Injectable()
export class LoggingInterceptor implements NestInterceptor {
  private readonly logger = new JsonLogger(LoggingInterceptor.name);

  intercept(context: ExecutionContext, next: CallHandler) {
    const request = context.switchToHttp().getRequest<Request>();
    return next.handle().pipe(
      tap(() => this.logger.log({ path: request.url, method: request.method } as unknown as string)),
    );
  }
}
```
