# #024 「JSONデータ形式」

四国めたん「REST APIではJSONが標準のデータ形式です」
ずんだもん「NestJSでJSONを扱うときのポイントは？」
四国めたん「DTOで型を定義しclass-transformerでシリアル化を制御します」
ずんだもん「nullableやoptionalの扱いも明示できるね」
四国めたん「レスポンスはシリアライザーで不要なフィールドを隠せます」
ずんだもん「ExposeやExcludeが活躍するやつだね」
四国めたん「JSON SchemaやOpenAPIで契約を共有しましょう」
ずんだもん「型と定義を連携させれば変化に強くなるよ！」

---

## 📺 画面表示用コード

```typescript
// dto/user.dto.ts
import { Exclude, Expose, Transform } from 'class-transformer';
import { ApiProperty } from '@nestjs/swagger';

export class UserDto {
  @ApiProperty()
  @Expose()
  id!: string;

  @ApiProperty()
  @Expose()
  email!: string;

  @Exclude()
  passwordHash!: string;

  @ApiProperty({ required: false, nullable: true })
  @Expose()
  @Transform(({ value }) => value ?? null)
  nickname?: string | null;
}

// users.controller.ts
import { Controller, Get } from '@nestjs/common';
import { plainToInstance } from 'class-transformer';
import { UserDto } from './dto/user.dto';

@Controller('users')
export class UsersController {
  @Get()
  findAll() {
    const rows = [{ id: '1', email: 'user@example.com', passwordHash: '***' }];
    return plainToInstance(UserDto, rows, { excludeExtraneousValues: true });
  }
}

// swagger-config.ts
import { DocumentBuilder } from '@nestjs/swagger';

export const swaggerConfig = new DocumentBuilder()
  .setTitle('Example API')
  .setDescription('Example schema for JSON contracts')
  .setVersion('1.0')
  .build();
```
