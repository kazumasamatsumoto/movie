# #007 ã€Œv11æ–°æ©Ÿèƒ½ - ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹å¼·åŒ–ã€

å››å›½ã‚ãŸã‚“ã€Œv11ã§ã¯ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚µãƒãƒ¼ãƒˆã‚‚å¼·åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€Œé«˜è² è·ç’°å¢ƒã‚’æ„è­˜ã—ãŸã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãªã‚“ã ã­ã€
å››å›½ã‚ãŸã‚“ã€ŒNATSã‚„Kafkaãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã§ãƒãƒƒãƒé€ä¿¡ã‚„ä¸¦åˆ—å‡¦ç†ã®è¨­å®šãŒç´°ã‹ãã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€
ãšã‚“ã ã‚‚ã‚“ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¯è¦³æ¸¬æ€§ã‚‚å‘ä¸Šã—ãŸã£ã¦èã„ãŸã‚ˆã€
å››å›½ã‚ãŸã‚“ã€Œã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã¨ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã®æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆã‚‚æ•´ç†ã•ã‚Œã¦ã„ã¾ã™ã€
ãšã‚“ã ã‚‚ã‚“ã€Œç‹¬è‡ªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã‚‚çµ„ã¿è¾¼ã¿ã‚„ã™ã„ã‚“ã ã­ã€
å››å›½ã‚ãŸã‚“ã€Œãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç”¨ã®Hybridã‚¢ãƒ—ãƒªæ§‹æˆã‚‚ã‚µãƒãƒ¼ãƒˆãŒå¼·åŒ–ã•ã‚Œã¾ã—ãŸã€
ãšã‚“ã ã‚‚ã‚“ã€Œãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹æ§‹æˆã«è‡ªä¿¡ã‚’æŒã£ã¦æŒ‘ã‚ã‚‹ã‚ˆï¼ã€

---

## ğŸ“º ç”»é¢è¡¨ç¤ºç”¨ã‚³ãƒ¼ãƒ‰

```typescript
// main.micro.ts
import { NestFactory } from '@nestjs/core';
import { MicroserviceOptions, Transport } from '@nestjs/microservices';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.createMicroservice<MicroserviceOptions>(AppModule, {
    transport: Transport.NATS,
    options: { servers: ['nats://localhost:4222'], maxReconnectAttempts: 5 },
  });
  await app.listen();
}
bootstrap();

// metrics.controller.ts
import { Controller } from '@nestjs/common';
import { MessagePattern, Payload } from '@nestjs/microservices';

@Controller()
export class MetricsController {
  @MessagePattern('metrics.ingest')
  handleMetric(@Payload() payload: Record<string, unknown>) {
    return { status: 'accepted', ...payload };
  }
}

// micro.config.ts
import { CustomTransportStrategy } from '@nestjs/microservices';

export const microOptions = {
  retryAttempts: 3,
  retryDelay: 500,
  strategy: new (class implements CustomTransportStrategy {
    listen() {
      /* connect to broker with v11 hooks */
    }
    close() {
      /* graceful shutdown */
    }
  })(),
};
```
