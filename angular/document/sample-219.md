# #219 「コンテンツ投影の制約事項」

## 概要
コンテンツ投影を利用する際に知っておくべき制約や注意点を整理し、期待しない挙動を防ぎます。静的評価や複数スロットの制限など、Angular固有の仕様を理解します。

## 学習目標
- コンテンツ投影が静的に評価されることを理解する
- 複数スロットのルールやselectマッチングの制限を把握する
- 動的な移動や再利用が難しいケースを説明できるようにする

## 技術ポイント
- **静的評価**: コンテンツ投影はコンパイル時に決定され、実行時にスロットを変更できない
- **単一マッチ**: 1つの要素は最初にマッチした`ng-content`スロットにのみ挿入される
- **ネスト制限**: 複雑なネスト投影は可読性・パフォーマンスに影響するため注意が必要

## 📺 画面表示用コード（動画用）

```html
<!-- selectにマッチしないとデフォルトスロットへ -->
<ng-content select="[header]"></ng-content>
<ng-content></ng-content>
```

```typescript
// 静的評価のため、動的に別スロットへ移動できない
```

```html
<!-- 1要素が複数スロットへ入ることはない -->
```

## 💻 詳細実装例（学習用）
```markdown
### 主な制約まとめ
1. **静的投影**: コンテンツ投影は親テンプレートの構造が確定した時点で決定され、実行時に別スロットへ移動できない。
2. **単一スロット**: 1つの要素は最初にマッチした`ng-content`に挿入され、他のスロットへは入らない。
3. **select評価**: CSSセレクタにマッチしない要素はデフォルトスロットへ回る。複雑なセレクタはミスマッチを招きやすい。
4. **View構造に依存**: 投影されたコンテンツの変更検知は親ビューで行われ、子コンポーネント側では直接バインディングできない。
5. **動的生成**: 完全に動的な位置変更が必要な場合は`ViewContainerRef`でEmbeddedViewを操作するなど別手段が必要。
```

## ベストプラクティス
- コンテンツ投影の制約を把握し、必要であればテンプレートをInputで受ける、`ngTemplateOutlet`を使う等の代替パターンを検討する
- 1要素を複数箇所に出力したい場合、テンプレートを複製するかループを用意する
- 複雑なレイアウトではコンポーネント分割やディレクティブで責務を整理し、投影の深すぎるネストを避ける

## 注意点
- `ng-content`の配置順序とselectが一致しないとコンテンツが期待どおりに表示されない
- 動的にスロットを切り替えることはできないため、`ngTemplateOutlet`やViewContainerRefを使う必要がある
- 投影先でスタイルやイベントを過剰に操作すると、親との依存が強くなり保守が困難になる

## 関連技術
- `ngTemplateOutlet`や`ViewContainerRef`による動的描画（#202, #205）
- コンテンツ投影のベストプラクティス（#218）
- Web Componentsのslotとの比較（#220）


